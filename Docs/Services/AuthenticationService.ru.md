# Authentication service

Доступно на других языках: [English/Английский](AuthenticationService.md), [Russian/Русский](AuthenticationService.ru.md).

Сервис аутентификации и выдачи сессионных токенов 

![SystemOverview](../img/SystemOverview.png)

## Описание API для аутентификации

- Данный сервис производит запись/чтение сессионных токенов в БД и уведомляет [Last seen service](LastSeenService.ru.md) о выдаче определенному пользователю сессионного токена.
- В качестве БД используется PostgreSQL.
- В целях уменьшения риска компрометации персональных данных, сервис не хранит никаких данных, связанных с пользователями: только GUID пользователей, а также таблицы, связанные с аутентификацией ("сессионный токен", "временная регистрация", "подозрительная регистрация").
- На клиентском приложении хранится только таблица "проверка кода".
- Любой новый вход в приложение обновляет дату окончания действия сессионного токена.

В качестве сервиса аутентификации используется библиотека [workflow-auth](https://github.com/alexeysp11/workflow-auth) (в частности, класс [AuthResolverDB](https://github.com/alexeysp11/workflow-auth/blob/main/docs/authbl/AuthResolverDB.md)).

![AuthService](../img/AuthService.png)

Используемые методы класса [AuthResolverDB](https://github.com/alexeysp11/workflow-auth/blob/main/docs/authbl/AuthResolverDB.md): 
- `AddUser()`;
- `VerifyUserCredentials()`.

### Джобы

- Пометка записей в таблице проверки кода регистрации на клиентском приложении как устаревшие и перемещение на сервис (каждые 15-30 минут): если время отправки запроса было раньше продолжительности перепроверки и не закрыта.
- Копирование подозрительных записей из временной регистрации в таблицу с подозрительной регистрацией (1 раз в сутки): если было N и более не закрытых как успешных.
- Удаление устаревших записей из проверки кода регистрации на клиентском приложении и временной регистрации на сервисе (1-7 раз в неделю).
